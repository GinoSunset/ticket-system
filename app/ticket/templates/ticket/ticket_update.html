{% extends 'ticsys/index.html' %}
{% block content %}
<h1>Заявка №{{ticket.pk}}</h1>
<div class="ui  container segment">
  <div class="ui horizontal list">    
    <div class="item"> 
      <div class="header"> SAP</div> 
      {{ticket.sap_id}}
    </div>
    <div class="item"> 
      <div class="header"> Тип</div> 
      {{ticket.type_ticket}}
    </div>
    <div class="item"> 
      <div class="header"> Заказчик</div> 
      {{ticket.customer}}
    </div>
    <div class="item"> 
      <div class="header"> Исполнитель</div> 
      {% firstof ticket.contractor "Не назначен" %}
    </div>
    <div class="item"> 
      <div class="header"> Статус</div> 
      {% if ticket.status %} <div class="ui {{ticket.get_color_status}} label">{{ticket.status}}</div>{% endif %}
    </div>
    <div class="item"> 
      <div class="header"> Город</div> 
      {{ticket.city}}
    </div>
    <div class="item"> 
      <div class="header"> Адрес</div> 
      {{ticket.address}}
    </div>
  </div>
  <div class=" ui list ">
    <div class="item"> 
      <div class="header"> Описание</div> 
      {{ticket.description}}
    </div>
  </div>        
  {% if user.is_operator %}
  <div id="run_modal" class="ui right floated button ">Изменить</div>
  {% endif %}
  <a href="{% url 'comment-update' ticket.pk %}" class="ui right floated info button ">Добавить комментарий</a>
</div>

<div class="ui comments">
{% for comment in ticket.comments.all %}
<div class="comment">
  <a class="avatar">
    <img src="{{comment.author.get_avatar}}">
  </a>
  <div class="content">
    <a class="author">{{comment.author}}</a>
    <div class="metadata">
      <span class="date">{{comment.date_create|date}}</span>
    </div>
    <div class="text">
    {% if comment.text %}
      {{comment.text}}
    {% else %}
      <i>No text</i>
      {% endif %}
    </div>
    
    {% if comment.file %}
    <div class="text">
      <div class="ui list">
        <div class="item">
          <i class="file icon"></i>
          <div class="content">
            <a href="{{comment.file.url}}"> {{comment.file.name}}</a>
          </div>
        </div>
      </div>
      
    </div>
    
    {% endif %}
    
  </div>
</div>
{% endfor %}
</div>

<div class="ui modal">
  <i class="close icon"></i>
  <div class="header">Изменить заявку</div>
  <div class="content">
    <form class="ui form" method="post">
        {{ form.non_field_errors }}
        {% csrf_token %}
        {% for field in form %}
        <div class="field">
            {{ field.errors }}
            {{ field.label_tag }} 
            {{ field }}
        </div>
        {% endfor %}
        <button class="ui button" type="submit">Изменить</button>
    </form>
  </div>
</div>
{% endblock content %}
{% block script %}
<script>
  $('.ui.modal')
  .modal('attach events', '#run_modal', 'show');
</script>
{% endblock script %}